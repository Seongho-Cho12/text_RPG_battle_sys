============================================================
[FAIL] tests/test_phase6_reactions.py::test_phase6_reaction_candidates_basic_melee_enemies
------------------------------------------------------------
[EXPERIMENT]
TITLE: 이동 직전 같은 그룹의 근접 적 전원이 반응공격 후보로 산출되는지 검증
    SETUP:
      - Allies:
        - A1 (근접)
      - Enemies (같은 그룹에 붙어 있는 상황 가정):
        - E1 (근접)
        - E2 (근접)
        - E3 (원거리)
      - 초기 상태:
        - A1/E1/E2/E3 모두 같은 그룹
    STEPS:
      1) create_battle([A1],[E1,E2,E3])
      2) 이동 직전 group_id를 prev_gid로 저장
      3) A1이 DISENGAGE로 그룹 이탈
      4) reaction_attack_candidates(bs, mover=A1, prev_group_id=prev_gid, reaction_immune=False)
    EXPECTED:
      - 근접 적 E1, E2만 후보
      - 원거리 적 E3는 제외

[TRACEBACK]
def test_phase6_reaction_candidates_basic_melee_enemies():
        """
        TITLE: 이동 직전 같은 그룹의 근접 적 전원이 반응공격 후보로 산출되는지 검증
        SETUP:
          - Allies:
            - A1 (근접)
          - Enemies (같은 그룹에 붙어 있는 상황 가정):
            - E1 (근접)
            - E2 (근접)
            - E3 (원거리)
          - 초기 상태:
            - A1/E1/E2/E3 모두 같은 그룹
        STEPS:
          1) create_battle([A1],[E1,E2,E3])
          2) 이동 직전 group_id를 prev_gid로 저장
          3) A1이 DISENGAGE로 그룹 이탈
          4) reaction_attack_candidates(bs, mover=A1, prev_group_id=prev_gid, reaction_immune=False)
        EXPECTED:
          - 근접 적 E1, E2만 후보
          - 원거리 적 E3는 제외
        """
        a1 = mk("A1", 1, 6, 5, "ALLY-", atk_range="MELEE")
        e1 = mk("E1", 1, 4, 5, "ENEMY-", atk_range="MELEE")
        e2 = mk("E2", 1, 3, 5, "ENEMY-", atk_range="MELEE")
        e3 = mk("E3", 1, 2, 5, "ENEMY-", atk_range="RANGED")
    
        eng = BattleEngine()
        bs = eng.create_battle([a1], [e1, e2, e3])
    
        A1 = CombatantID("A1")
    
        prev_gid = bs.combatants[A1].group_id
        disengage(bs, actor=A1)
    
        cands = reaction_attack_candidates(
            bs,
            mover=A1,
            prev_group_id=prev_gid,
            reaction_immune=False,
        )
    
>       assert set(cands) == {CombatantID("E1"), CombatantID("E2")}
E       AssertionError: assert set() == {'E1', 'E2'}
E         Extra items in the right set:
E         'E2'
E         'E1'
E         Use -v to get more diff

tests\test_phase6_reactions.py:70: AssertionError
============================================================
[PASS] tests/test_phase6_reactions.py::test_phase6_reaction_immune_movement_returns_empty
------------------------------------------------------------
[EXPERIMENT]
TITLE: 반응공격 면제 이동인 경우 후보가 항상 빈 리스트인지 검증
    SETUP:
      - Allies:
        - A1
      - Enemies:
        - E1 (근접)
      - 초기 상태:
        - A1/E1 같은 그룹
    STEPS:
      1) create_battle([A1],[E1])
      2) prev_gid 저장
      3) A1 DISENGAGE
      4) reaction_attack_candidates(..., reaction_immune=True)
    EXPECTED:
      - 후보 리스트는 항상 빈 리스트

============================================================
[PASS] tests/test_phase6_reactions.py::test_phase6_reaction_excludes_same_team
------------------------------------------------------------
[EXPERIMENT]
TITLE: 이동 직전 같은 그룹에 있더라도 같은 팀은 반응공격 후보에서 제외되는지 검증
    SETUP:
      - Allies:
        - A1 (이동자)
        - A2 (근접, 같은 팀)
      - Enemies: 없음
      - 초기 상태:
        - A1/A2 같은 그룹
    STEPS:
      1) create_battle([A1,A2],[])
      2) prev_gid 저장
      3) A1 DISENGAGE
      4) reaction_attack_candidates(..., reaction_immune=False)
    EXPECTED:
      - 같은 팀(A2)은 제외 → 후보는 빈 리스트

